<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aditya's Prediction ‚Äî India Market Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#080c14;--bg2:#0d1320;--bg3:#111827;--border:#1e2d45;
    --amber:#f5a623;--amber2:#ffcb6b;
    --green:#22c55e;--green2:#4ade80;
    --red:#ef4444;--red2:#f87171;
    --blue:#3b82f6;--text:#e8edf5;--muted:#6b7fa3;--card:#0f1926;
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{background:var(--bg);color:var(--text);font-family:'DM Mono',monospace;min-height:100vh;overflow-x:hidden;}
  body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(245,166,35,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(245,166,35,0.03) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:0;}
  .container{max-width:1400px;margin:0 auto;padding:0 20px;position:relative;z-index:1;}

  .header{border-bottom:1px solid var(--border);padding:18px 0;background:rgba(8,12,20,0.95);position:sticky;top:0;z-index:100;backdrop-filter:blur(12px);}
  .header-inner{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;}
  .logo{font-family:'Syne',sans-serif;font-size:1.5rem;font-weight:800;color:var(--amber);display:flex;align-items:center;gap:10px;}
  .logo span{color:var(--text);}
  .logo-icon{width:32px;height:32px;background:var(--amber);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:18px;}
  .header-right{display:flex;align-items:center;gap:16px;flex-wrap:wrap;}
  .live-badge{display:flex;align-items:center;gap:6px;background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.3);border-radius:20px;padding:4px 12px;font-size:.7rem;color:var(--green2);}
  .live-dot{width:6px;height:6px;background:var(--green);border-radius:50%;animation:pulse 2s infinite;}
  @keyframes pulse{0%,100%{opacity:1;transform:scale(1);}50%{opacity:.5;transform:scale(1.3);}}
  .upd{color:var(--muted);font-size:.72rem;}
  .nifty-bar{display:flex;gap:16px;flex-wrap:wrap;align-items:center;}
  .nifty-item{font-size:.78rem;}
  .nifty-name{color:var(--muted);margin-right:5px;}
  .refresh-btn{background:transparent;border:1px solid var(--border);color:var(--muted);border-radius:6px;padding:5px 14px;font-family:'DM Mono',monospace;font-size:.72rem;cursor:pointer;transition:all .2s;}
  .refresh-btn:hover{border-color:var(--amber);color:var(--amber);}
  .refresh-btn:disabled{opacity:.5;cursor:not-allowed;}

  .timeline-row{display:flex;align-items:center;gap:8px;flex-wrap:wrap;padding:18px 0 0;}
  .tl-label{color:var(--muted);font-size:.75rem;margin-right:4px;}
  .tab{background:var(--bg3);border:1px solid var(--border);color:var(--muted);border-radius:6px;padding:7px 18px;font-family:'DM Mono',monospace;font-size:.78rem;cursor:pointer;transition:all .2s;}
  .tab:hover{border-color:var(--amber);color:var(--amber);}
  .tab.active{background:var(--amber);border-color:var(--amber);color:#000;font-weight:500;}

  .banner{border-radius:8px;padding:12px 18px;font-size:.78rem;margin:14px 0;display:none;}
  .banner.info{background:rgba(245,166,35,.08);border:1px solid rgba(245,166,35,.25);color:var(--amber2);}
  .banner.success{background:rgba(34,197,94,.08);border:1px solid rgba(34,197,94,.25);color:var(--green2);}

  .overview-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(155px,1fr));gap:12px;margin:18px 0;}
  .stat-card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:16px;transition:border-color .2s;}
  .stat-card:hover{border-color:var(--amber);}
  .stat-label{color:var(--muted);font-size:.68rem;text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;}
  .stat-value{font-size:1.3rem;font-weight:500;}
  .stat-sub{font-size:.7rem;margin-top:3px;color:var(--muted);}
  .up{color:var(--green2);}.dn{color:var(--red2);}.neu{color:var(--muted);}

  .sec-header{display:flex;align-items:center;gap:12px;margin:30px 0 14px;}
  .sec-title{font-family:'Syne',sans-serif;font-size:1.1rem;font-weight:700;}
  .sec-badge{background:var(--amber);color:#000;font-size:.65rem;font-weight:600;border-radius:4px;padding:2px 8px;}
  .sec-line{flex:1;height:1px;background:var(--border);}

  .top5-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;}
  @media(max-width:900px){.top5-grid{grid-template-columns:repeat(2,1fr);}}
  @media(max-width:480px){.top5-grid{grid-template-columns:1fr;}}
  .top5-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px 16px;position:relative;overflow:hidden;transition:transform .2s,border-color .2s;}
  .top5-card:hover{transform:translateY(-2px);border-color:var(--amber);}
  .top5-card.r1{border-color:var(--amber);background:linear-gradient(135deg,rgba(245,166,35,.08),var(--card));}
  .top5-card.r1::after{content:'üëë';position:absolute;top:12px;right:12px;font-size:18px;}
  .rank-num{display:inline-block;width:24px;height:24px;background:var(--bg3);border-radius:6px;text-align:center;line-height:24px;font-size:.75rem;color:var(--muted);margin-bottom:12px;}
  .r1 .rank-num{background:var(--amber);color:#000;}
  .t5n{font-family:'Syne',sans-serif;font-size:.95rem;font-weight:700;margin-bottom:2px;}
  .t5s{font-size:.65rem;color:var(--muted);margin-bottom:14px;}
  .t5p{font-size:1.6rem;font-weight:500;}
  .t5pr{font-size:.78rem;color:var(--muted);margin-top:4px;}
  .t5v{font-size:.68rem;color:var(--muted);margin-top:8px;padding-top:8px;border-top:1px solid var(--border);}

  .top15-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px;}
  .t15c{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:14px;display:flex;align-items:center;gap:12px;transition:border-color .2s,transform .2s;}
  .t15c:hover{border-color:rgba(34,197,94,.4);transform:translateX(2px);}
  .t15r{font-size:.7rem;color:var(--muted);min-width:22px;}
  .t15i{flex:1;min-width:0;}
  .t15n{font-size:.82rem;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
  .t15s{font-size:.62rem;color:var(--muted);}
  .t15p{font-size:1rem;font-weight:500;text-align:right;min-width:60px;}

  .table-wrap{background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden;margin-bottom:32px;}
  .table-toolbar{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid var(--border);gap:12px;flex-wrap:wrap;}
  .search-input{background:var(--bg3);border:1px solid var(--border);color:var(--text);border-radius:6px;padding:6px 12px;font-family:'DM Mono',monospace;font-size:.78rem;outline:none;width:220px;transition:border-color .2s;}
  .search-input:focus{border-color:var(--amber);}
  .tinfo{font-size:.72rem;color:var(--muted);}
  .tscroll{overflow-x:auto;}
  table{width:100%;border-collapse:collapse;}
  thead th{background:var(--bg3);padding:10px 14px;text-align:left;font-size:.68rem;text-transform:uppercase;letter-spacing:.8px;color:var(--muted);cursor:pointer;white-space:nowrap;user-select:none;border-bottom:1px solid var(--border);transition:color .2s;}
  thead th:hover{color:var(--amber);}
  tbody tr{border-bottom:1px solid rgba(30,45,69,.4);transition:background .15s;}
  tbody tr:hover{background:rgba(245,166,35,.03);}
  tbody tr:last-child{border-bottom:none;}
  td{padding:10px 14px;font-size:.78rem;white-space:nowrap;}
  .cr{color:var(--muted);font-size:.72rem;}.cn{color:var(--text);font-weight:500;}.ct{color:var(--muted);font-size:.7rem;}.cp{color:var(--text);}
  .cu{color:var(--green2);}.cd{color:var(--red2);}.cv{color:var(--blue);}
  .spill{display:inline-block;background:var(--bg3);border:1px solid var(--border);border-radius:4px;padding:2px 7px;font-size:.62rem;color:var(--muted);}
  .vwrap{display:flex;align-items:center;gap:8px;}
  .vbg{height:4px;border-radius:2px;background:rgba(59,130,246,.15);width:60px;}
  .vfill{height:100%;border-radius:2px;background:var(--blue);}
  .empty-r td{color:var(--muted);text-align:center;padding:30px;}

  .footer{border-top:1px solid var(--border);padding:20px 0;margin-top:40px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;}
  .ft{font-size:.7rem;color:var(--muted);}
  ::-webkit-scrollbar{width:6px;height:6px;}
  ::-webkit-scrollbar-track{background:var(--bg);}
  ::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px;}
</style>
</head>
<body>

<div class="header">
  <div class="container">
    <div class="header-inner">
      <div class="logo"><div class="logo-icon">üìà</div>Aditya's<span> Prediction</span></div>
      <div class="header-right">
        <div class="nifty-bar">
          <span class="nifty-item"><span class="nifty-name">NIFTY 50</span><span id="hN50">‚Äî</span></span>
          <span class="nifty-item"><span class="nifty-name">SENSEX</span><span id="hSX">‚Äî</span></span>
        </div>
        <div class="live-badge"><div class="live-dot"></div><span id="lLabel">NSE</span></div>
        <button class="refresh-btn" id="rBtn" onclick="doRefresh()">‚Ü∫ Refresh</button>
        <div class="upd" id="upd">Loading‚Ä¶</div>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="timeline-row">
    <span class="tl-label">PERIOD:</span>
    <button class="tab active" onclick="setTab('1d',this)">Today</button>
    <button class="tab" onclick="setTab('5d',this)">This Week</button>
    <button class="tab" onclick="setTab('1mo',this)">This Month</button>
    <button class="tab" onclick="setTab('ytd',this)">This Year</button>
    <button class="tab" onclick="setTab('1y',this)">12 Months</button>
  </div>

  <div class="banner info" id="banner"></div>

  <div class="overview-grid">
    <div class="stat-card"><div class="stat-label">Total Gainers</div><div class="stat-value" id="sg">‚Äî</div><div class="stat-sub">of 100 tracked</div></div>
    <div class="stat-card"><div class="stat-label">Avg Gain</div><div class="stat-value up" id="sa">‚Äî</div><div class="stat-sub" id="sp">Today</div></div>
    <div class="stat-card"><div class="stat-label">Best Performer</div><div class="stat-value" id="sb">‚Äî</div><div class="stat-sub up" id="sbv">‚Äî</div></div>
    <div class="stat-card"><div class="stat-label">Top Sector</div><div class="stat-value" id="ss">‚Äî</div><div class="stat-sub" id="ssv">‚Äî</div></div>
    <div class="stat-card"><div class="stat-label">Total Buy Volume</div><div class="stat-value" id="sv">‚Äî</div><div class="stat-sub">gainers only</div></div>
  </div>

  <div class="sec-header"><span class="sec-title">üèÜ Top 5 Best Performers</span><span class="sec-badge">ELITE</span><div class="sec-line"></div></div>
  <div class="top5-grid" id="t5"></div>

  <div class="sec-header"><span class="sec-title">üî• Top 15 Hot Stocks</span><span class="sec-badge">HOT</span><div class="sec-line"></div></div>
  <div class="top15-grid" id="t15"></div>

  <div class="sec-header" style="margin-top:30px"><span class="sec-title">üìä Top 100 ‚Äî Full Table</span><div class="sec-line"></div></div>
  <div class="table-wrap">
    <div class="table-toolbar">
      <input class="search-input" type="text" placeholder="Search company or ticker‚Ä¶" oninput="onSearch(this.value)">
      <div class="tinfo" id="ti">‚Äî</div>
    </div>
    <div class="tscroll">
      <table>
        <thead><tr>
          <th onclick="onSort('rank')"># <span id="s0"></span></th>
          <th onclick="onSort('name')">Company <span id="s1"></span></th>
          <th onclick="onSort('ticker')">Ticker <span id="s2"></span></th>
          <th onclick="onSort('sector')">Sector <span id="s3"></span></th>
          <th onclick="onSort('price')">Price ‚Çπ <span id="s4"></span></th>
          <th onclick="onSort('change')">Change % <span id="s5">‚Üì</span></th>
          <th onclick="onSort('changeAbs')">Change ‚Çπ <span id="s6"></span></th>
          <th onclick="onSort('volume')">Volume <span id="s7"></span></th>
          <th onclick="onSort('mcap')">Mkt Cap <span id="s8"></span></th>
        </tr></thead>
        <tbody id="tb"></tbody>
      </table>
    </div>
  </div>

  <div class="sec-header"><span class="sec-title">üìà Volume Analysis ‚Äî Stocks That Went Up</span><span class="sec-badge">VOL</span><div class="sec-line"></div></div>
  <div class="table-wrap">
    <div class="table-toolbar"><div class="tinfo">Buy volume for gainers ‚Äî higher = stronger market conviction</div></div>
    <div class="tscroll">
      <table>
        <thead><tr><th>#</th><th>Company</th><th>Price ‚Çπ</th><th>Change %</th><th>Volume</th><th>vs Avg</th><th>Buy Value</th><th>Signal</th></tr></thead>
        <tbody id="vb"></tbody>
      </table>
    </div>
  </div>

  <div class="footer">
    <div class="ft">üìà Aditya's Prediction ‚Äî Data via Yahoo Finance (NSE). For informational purposes only. Not financial advice.</div>
    <div class="ft">Last updated: <span id="ft">‚Äî</span></div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STOCKS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const STOCKS=[
  {t:'RELIANCE.NS',n:'Reliance Industries',s:'Energy'},
  {t:'TCS.NS',n:'Tata Consultancy Services',s:'IT'},
  {t:'HDFCBANK.NS',n:'HDFC Bank',s:'Banking'},
  {t:'INFY.NS',n:'Infosys',s:'IT'},
  {t:'ICICIBANK.NS',n:'ICICI Bank',s:'Banking'},
  {t:'HINDUNILVR.NS',n:'Hindustan Unilever',s:'FMCG'},
  {t:'KOTAKBANK.NS',n:'Kotak Mahindra Bank',s:'Banking'},
  {t:'SBIN.NS',n:'State Bank of India',s:'Banking'},
  {t:'BHARTIARTL.NS',n:'Bharti Airtel',s:'Telecom'},
  {t:'BAJFINANCE.NS',n:'Bajaj Finance',s:'Finance'},
  {t:'ASIANPAINT.NS',n:'Asian Paints',s:'Chemicals'},
  {t:'MARUTI.NS',n:'Maruti Suzuki',s:'Auto'},
  {t:'HCLTECH.NS',n:'HCL Technologies',s:'IT'},
  {t:'AXISBANK.NS',n:'Axis Bank',s:'Banking'},
  {t:'LT.NS',n:'Larsen & Toubro',s:'Capital Goods'},
  {t:'SUNPHARMA.NS',n:'Sun Pharmaceutical',s:'Pharma'},
  {t:'WIPRO.NS',n:'Wipro',s:'IT'},
  {t:'NESTLEIND.NS',n:'Nestle India',s:'FMCG'},
  {t:'TITAN.NS',n:'Titan Company',s:'Consumer'},
  {t:'ADANIPORTS.NS',n:'Adani Ports',s:'Infrastructure'},
  {t:'ULTRACEMCO.NS',n:'UltraTech Cement',s:'Cement'},
  {t:'POWERGRID.NS',n:'Power Grid Corp',s:'Utilities'},
  {t:'NTPC.NS',n:'NTPC',s:'Utilities'},
  {t:'ONGC.NS',n:'ONGC',s:'Energy'},
  {t:'DIVISLAB.NS',n:"Divi's Laboratories",s:'Pharma'},
  {t:'BAJAJFINSV.NS',n:'Bajaj Finserv',s:'Finance'},
  {t:'DRREDDY.NS',n:"Dr Reddy's Labs",s:'Pharma'},
  {t:'CIPLA.NS',n:'Cipla',s:'Pharma'},
  {t:'GRASIM.NS',n:'Grasim Industries',s:'Diversified'},
  {t:'BPCL.NS',n:'BPCL',s:'Energy'},
  {t:'JSWSTEEL.NS',n:'JSW Steel',s:'Metals'},
  {t:'TECHM.NS',n:'Tech Mahindra',s:'IT'},
  {t:'INDUSINDBK.NS',n:'IndusInd Bank',s:'Banking'},
  {t:'HINDALCO.NS',n:'Hindalco Industries',s:'Metals'},
  {t:'COALINDIA.NS',n:'Coal India',s:'Mining'},
  {t:'BRITANNIA.NS',n:'Britannia Industries',s:'FMCG'},
  {t:'HEROMOTOCO.NS',n:'Hero MotoCorp',s:'Auto'},
  {t:'SHREECEM.NS',n:'Shree Cement',s:'Cement'},
  {t:'EICHERMOT.NS',n:'Eicher Motors',s:'Auto'},
  {t:'APOLLOHOSP.NS',n:'Apollo Hospitals',s:'Healthcare'},
  {t:'ADANIENT.NS',n:'Adani Enterprises',s:'Diversified'},
  {t:'TATACONSUM.NS',n:'Tata Consumer Products',s:'FMCG'},
  {t:'TATASTEEL.NS',n:'Tata Steel',s:'Metals'},
  {t:'TATAMOTORS.NS',n:'Tata Motors',s:'Auto'},
  {t:'LTIM.NS',n:'LTIMindtree',s:'IT'},
  {t:'BAJAJ-AUTO.NS',n:'Bajaj Auto',s:'Auto'},
  {t:'SBILIFE.NS',n:'SBI Life Insurance',s:'Insurance'},
  {t:'HDFCLIFE.NS',n:'HDFC Life Insurance',s:'Insurance'},
  {t:'PIDILITIND.NS',n:'Pidilite Industries',s:'Chemicals'},
  {t:'DABUR.NS',n:'Dabur India',s:'FMCG'},
  {t:'GODREJCP.NS',n:'Godrej Consumer Products',s:'FMCG'},
  {t:'MARICO.NS',n:'Marico',s:'FMCG'},
  {t:'BERGEPAINT.NS',n:'Berger Paints',s:'Chemicals'},
  {t:'HAVELLS.NS',n:'Havells India',s:'Electricals'},
  {t:'SIEMENS.NS',n:'Siemens India',s:'Capital Goods'},
  {t:'TORNTPHARM.NS',n:'Torrent Pharma',s:'Pharma'},
  {t:'LUPIN.NS',n:'Lupin',s:'Pharma'},
  {t:'MUTHOOTFIN.NS',n:'Muthoot Finance',s:'Finance'},
  {t:'PNB.NS',n:'Punjab National Bank',s:'Banking'},
  {t:'BANKBARODA.NS',n:'Bank of Baroda',s:'Banking'},
  {t:'CANBK.NS',n:'Canara Bank',s:'Banking'},
  {t:'AUROPHARMA.NS',n:'Aurobindo Pharma',s:'Pharma'},
  {t:'JUBLFOOD.NS',n:'Jubilant FoodWorks',s:'Consumer'},
  {t:'DMART.NS',n:'Avenue Supermarts',s:'Retail'},
  {t:'ZOMATO.NS',n:'Zomato',s:'Tech'},
  {t:'IRCTC.NS',n:'IRCTC',s:'Travel'},
  {t:'HAL.NS',n:'Hindustan Aeronautics',s:'Defence'},
  {t:'BEL.NS',n:'Bharat Electronics',s:'Defence'},
  {t:'DLF.NS',n:'DLF',s:'Real Estate'},
  {t:'VEDL.NS',n:'Vedanta',s:'Metals'},
  {t:'SAIL.NS',n:'SAIL',s:'Metals'},
  {t:'NMDC.NS',n:'NMDC',s:'Mining'},
  {t:'RECLTD.NS',n:'REC Limited',s:'Finance'},
  {t:'PFC.NS',n:'Power Finance Corp',s:'Finance'},
  {t:'GAIL.NS',n:'GAIL India',s:'Energy'},
  {t:'IOC.NS',n:'Indian Oil Corporation',s:'Energy'},
  {t:'CONCOR.NS',n:'Container Corp of India',s:'Logistics'},
  {t:'ABB.NS',n:'ABB India',s:'Capital Goods'},
  {t:'BOSCHLTD.NS',n:'Bosch India',s:'Auto'},
  {t:'TATAPOWER.NS',n:'Tata Power',s:'Utilities'},
  {t:'ADANIGREEN.NS',n:'Adani Green Energy',s:'Utilities'},
  {t:'CHOLAFIN.NS',n:'Cholamandalam Finance',s:'Finance'},
  {t:'CUMMINSIND.NS',n:'Cummins India',s:'Capital Goods'},
  {t:'AMBUJACEM.NS',n:'Ambuja Cements',s:'Cement'},
  {t:'ACC.NS',n:'ACC',s:'Cement'},
  {t:'SOLARINDS.NS',n:'Solar Industries',s:'Chemicals'},
  {t:'IDFCFIRSTB.NS',n:'IDFC First Bank',s:'Banking'},
  {t:'FEDERALBNK.NS',n:'Federal Bank',s:'Banking'},
  {t:'BANDHANBNK.NS',n:'Bandhan Bank',s:'Banking'},
  {t:'MOTHERSON.NS',n:'Motherson Sumi',s:'Auto'},
  {t:'BALKRISIND.NS',n:'Balkrishna Industries',s:'Auto'},
  {t:'MFSL.NS',n:'Max Financial Services',s:'Insurance'},
  {t:'ICICIPRULI.NS',n:'ICICI Prudential Life',s:'Insurance'},
  {t:'SUNDARMFIN.NS',n:'Sundaram Finance',s:'Finance'},
  {t:'ASTRAL.NS',n:'Astral',s:'Consumer'},
  {t:'POLYCAB.NS',n:'Polycab India',s:'Electricals'},
  {t:'APLAPOLLO.NS',n:'APL Apollo Tubes',s:'Metals'},
  {t:'PAGEIND.NS',n:'Page Industries',s:'Consumer'},
  {t:'NAUKRI.NS',n:'Info Edge',s:'Tech'},
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let DATA=[], curTab='1d', sortK='change', sortD=-1, searchQ='';

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DEMO DATA (base prices, realistic)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const BASE={
  'ZOMATO.NS':{p:232,c:6.84,v:52300000,m:2.05e12},
  'HAL.NS':{p:4182,c:5.31,v:890000,m:2.8e12},
  'ADANIGREEN.NS':{p:1045,c:4.97,v:3200000,m:1.65e12},
  'BEL.NS':{p:312,c:4.72,v:18000000,m:2.28e12},
  'TATAMOTORS.NS':{p:787,c:4.11,v:12000000,m:2.9e12},
  'TATAPOWER.NS':{p:421,c:3.88,v:9800000,m:1.34e12},
  'SOLARINDS.NS':{p:9870,c:3.55,v:120000,m:8.9e11},
  'PFC.NS':{p:472,c:3.31,v:7600000,m:1.56e12},
  'RECLTD.NS':{p:503,c:3.18,v:6500000,m:1.32e12},
  'APLAPOLLO.NS':{p:1621,c:3.02,v:480000,m:4.3e11},
  'POLYCAB.NS':{p:6820,c:2.91,v:210000,m:1.03e12},
  'BAJFINANCE.NS':{p:7240,c:2.75,v:2100000,m:4.38e12},
  'CHOLAFIN.NS':{p:1284,c:2.61,v:1800000,m:1.06e12},
  'HINDALCO.NS':{p:676,c:2.48,v:5800000,m:1.52e12},
  'JSWSTEEL.NS':{p:914,c:2.33,v:4200000,m:2.23e12},
  'ADANIPORTS.NS':{p:1342,c:2.18,v:2900000,m:2.91e12},
  'NTPC.NS':{p:362,c:2.05,v:8200000,m:3.51e12},
  'POWERGRID.NS':{p:317,c:1.98,v:6700000,m:2.95e12},
  'CUMMINSIND.NS':{p:3421,c:1.87,v:340000,m:9.5e11},
  'ABB.NS':{p:7640,c:1.74,v:180000,m:1.62e12},
  'RELIANCE.NS':{p:1289,c:1.62,v:9800000,m:1.75e13},
  'TATASTEEL.NS':{p:138,c:1.54,v:28000000,m:1.7e12},
  'VEDL.NS':{p:467,c:1.45,v:7600000,m:1.73e12},
  'COALINDIA.NS':{p:432,c:1.38,v:6400000,m:2.66e12},
  'NMDC.NS':{p:218,c:1.31,v:9100000,m:6.3e11},
  'SAIL.NS':{p:128,c:1.24,v:14000000,m:5.3e11},
  'GAIL.NS':{p:196,c:1.17,v:8900000,m:1.25e12},
  'IOC.NS':{p:154,c:1.12,v:12000000,m:2.17e12},
  'BPCL.NS':{p:296,c:1.05,v:7100000,m:1.28e12},
  'ONGC.NS':{p:264,c:0.98,v:10200000,m:3.32e12},
  'SIEMENS.NS':{p:7210,c:0.91,v:97000,m:2.56e12},
  'HAVELLS.NS':{p:1672,c:0.86,v:1200000,m:1.05e12},
  'MARUTI.NS':{p:12420,c:0.79,v:380000,m:3.75e12},
  'BAJAJ-AUTO.NS':{p:9240,c:0.74,v:310000,m:2.67e12},
  'EICHERMOT.NS':{p:4980,c:0.68,v:270000,m:1.36e12},
  'HEROMOTOCO.NS':{p:4790,c:0.63,v:520000,m:9.57e11},
  'BOSCHLTD.NS':{p:36800,c:0.58,v:42000,m:1.09e12},
  'MOTHERSON.NS':{p:178,c:0.53,v:7800000,m:1.25e12},
  'BALKRISIND.NS':{p:2940,c:0.49,v:280000,m:5.67e11},
  'TCS.NS':{p:3921,c:0.41,v:1600000,m:1.42e13},
  'INFY.NS':{p:1798,c:0.37,v:4800000,m:7.46e12},
  'HCLTECH.NS':{p:1742,c:0.33,v:2900000,m:4.73e12},
  'WIPRO.NS':{p:308,c:0.29,v:6100000,m:1.61e12},
  'TECHM.NS':{p:1648,c:0.26,v:1700000,m:1.61e12},
  'LTIM.NS':{p:5620,c:0.22,v:480000,m:1.66e12},
  'NAUKRI.NS':{p:8120,c:0.18,v:180000,m:1.04e12},
  'HDFCBANK.NS':{p:1754,c:0.14,v:8600000,m:1.34e13},
  'ICICIBANK.NS':{p:1298,c:0.11,v:9200000,m:9.19e12},
  'AXISBANK.NS':{p:1187,c:0.08,v:6800000,m:3.64e12},
  'KOTAKBANK.NS':{p:1892,c:0.05,v:4100000,m:3.77e12},
  'SBIN.NS':{p:812,c:0.03,v:14000000,m:7.26e12},
  'INDUSINDBK.NS':{p:1042,c:-0.04,v:3800000,m:8.1e11},
  'IDFCFIRSTB.NS':{p:67,c:-0.09,v:22000000,m:4.8e11},
  'FEDERALBNK.NS':{p:198,c:-0.13,v:6200000,m:4.8e11},
  'BANDHANBNK.NS':{p:172,c:-0.18,v:5400000,m:2.77e11},
  'PNB.NS':{p:104,c:-0.24,v:18000000,m:1.15e12},
  'BANKBARODA.NS':{p:238,c:-0.29,v:9600000,m:1.23e12},
  'CANBK.NS':{p:107,c:-0.35,v:12000000,m:9.7e11},
  'SBILIFE.NS':{p:1648,c:-0.4,v:1100000,m:1.65e12},
  'HDFCLIFE.NS':{p:692,c:-0.45,v:2800000,m:1.49e12},
  'ICICIPRULI.NS':{p:712,c:-0.51,v:1900000,m:1.02e12},
  'MFSL.NS':{p:1124,c:-0.56,v:640000,m:3.4e11},
  'MUTHOOTFIN.NS':{p:2140,c:-0.6,v:540000,m:8.6e11},
  'BAJAJFINSV.NS':{p:1892,c:-0.65,v:1400000,m:3.01e12},
  'SUNDARMFIN.NS':{p:4980,c:-0.7,v:92000,m:2.92e11},
  'LT.NS':{p:3612,c:-0.75,v:1600000,m:4.97e12},
  'ULTRACEMCO.NS':{p:11820,c:-0.8,v:270000,m:3.41e12},
  'SHREECEM.NS':{p:27400,c:-0.84,v:52000,m:9.87e11},
  'AMBUJACEM.NS':{p:584,c:-0.89,v:3700000,m:2.32e12},
  'ACC.NS':{p:2180,c:-0.94,v:680000,m:4.1e11},
  'GRASIM.NS':{p:2842,c:-0.99,v:1100000,m:1.89e12},
  'DLF.NS':{p:812,c:-1.04,v:4200000,m:2.01e12},
  'SUNPHARMA.NS':{p:1782,c:-1.08,v:2600000,m:4.28e12},
  'DRREDDY.NS':{p:1282,c:-1.13,v:980000,m:2.14e12},
  'CIPLA.NS':{p:1524,c:-1.18,v:1400000,m:1.23e12},
  'DIVISLAB.NS':{p:6210,c:-1.22,v:320000,m:1.65e12},
  'LUPIN.NS':{p:2184,c:-1.27,v:920000,m:9.93e11},
  'TORNTPHARM.NS':{p:3380,c:-1.32,v:280000,m:5.72e11},
  'AUROPHARMA.NS':{p:1248,c:-1.36,v:1600000,m:7.31e11},
  'APOLLOHOSP.NS':{p:7180,c:-1.41,v:380000,m:1.03e12},
  'HINDUNILVR.NS':{p:2284,c:-1.46,v:1800000,m:5.36e12},
  'NESTLEIND.NS':{p:2342,c:-1.5,v:640000,m:2.26e12},
  'BRITANNIA.NS':{p:5820,c:-1.55,v:280000,m:1.4e12},
  'DABUR.NS':{p:542,c:-1.6,v:2900000,m:9.6e11},
  'GODREJCP.NS':{p:1082,c:-1.64,v:1600000,m:1.11e12},
  'MARICO.NS':{p:642,c:-1.69,v:2200000,m:8.3e11},
  'TATACONSUM.NS':{p:1028,c:-1.74,v:2400000,m:1.01e12},
  'TITAN.NS':{p:3620,c:-1.78,v:1200000,m:3.22e12},
  'ASIANPAINT.NS':{p:2284,c:-1.83,v:1600000,m:2.19e12},
  'BERGEPAINT.NS':{p:524,c:-1.88,v:1800000,m:5.1e11},
  'PIDILITIND.NS':{p:3240,c:-1.92,v:640000,m:1.64e12},
  'ASTRAL.NS':{p:2180,c:-1.97,v:480000,m:5.8e11},
  'PAGEIND.NS':{p:48200,c:-2.02,v:21000,m:5.37e11},
  'DMART.NS':{p:4820,c:-2.06,v:820000,m:3.14e12},
  'JUBLFOOD.NS':{p:582,c:-2.11,v:2100000,m:3.88e11},
  'IRCTC.NS':{p:812,c:-2.16,v:3200000,m:6.52e11},
  'CONCOR.NS':{p:842,c:-2.2,v:1400000,m:5.13e11},
  'ADANIENT.NS':{p:2840,c:-2.25,v:1800000,m:3.24e12},
  'BHARTIARTL.NS':{p:1842,c:-2.3,v:4800000,m:1.08e13},
};

function buildDemo(){
  // Seed by day so values are consistent within a day but change each day
  const day=Math.floor(Date.now()/86400000);
  const rng=i=>((Math.sin(day*127.1+i*31.7)*10000)%100)/100*0.6-0.3;
  return STOCKS.map((stk,i)=>{
    const b=BASE[stk.t];
    const dr=rng(i);
    const c1=b?b.c+dr:Math.sin(i*1.7)*2.5+dr;
    const px=b?b.p*(1+dr*0.003):500+i*18;
    const vol=b?b.v:1000000+i*40000;
    const mc=b?b.m:vol*px*40;
    return {
      ticker:stk.t,name:stk.n,sector:stk.s,
      price:px,change1d:c1,changeAbs:px*c1/100,
      volume:Math.round(vol),avgVolume:Math.round(vol*(0.7+Math.abs(Math.sin(i))*0.5)),
      mcap:mc,
      change5d:c1*1.5+rng(i+30)*0.3,
      change1mo:c1*3.2+rng(i+60),
      changeYtd:c1*5.4+rng(i+90)*2,
      change1y:c1*9.6+rng(i+120)*5,
    };
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LIVE FETCH (silent, background)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function tFetch(url,ms){
  return new Promise((ok,fail)=>{
    const ctrl=new XMLHttpRequest();
    const timer=setTimeout(()=>{ctrl.abort();fail(new Error('timeout'));},ms);
    ctrl.onload=()=>{clearTimeout(timer);
      try{ok(JSON.parse(ctrl.responseText));}catch(e){fail(new Error('bad json'));}
    };
    ctrl.onerror=()=>{clearTimeout(timer);fail(new Error('network'));};
    ctrl.onabort=()=>{clearTimeout(timer);fail(new Error('aborted'));};
    ctrl.open('GET',url);ctrl.send();
  });
}

async function fetchLive(){
  const syms=STOCKS.map(s=>s.t).join(',');
  const target=`https://query2.finance.yahoo.com/v8/finance/spark?symbols=${encodeURIComponent(syms)}&range=1d&interval=5m`;
  const url=`https://corsproxy.io/?${encodeURIComponent(target)}`;
  const json=await tFetch(url,12000);
  const results=json?.spark?.result;
  if(!results||!results.length) throw new Error('no results');
  const map={};
  for(const r of results){
    try{
      const meta=r?.response?.[0]?.meta||{};
      const closes=(r?.response?.[0]?.indicators?.quote?.[0]?.close||[]).filter(v=>v!=null);
      const vols=(r?.response?.[0]?.indicators?.quote?.[0]?.volume||[]).filter(v=>v!=null);
      const price=closes.length?closes[closes.length-1]:0;
      const prev=meta.chartPreviousClose||meta.previousClose||0;
      if(price>0&&prev>0){
        map[r.symbol]={price,changePct:((price-prev)/prev)*100,changeAbs:price-prev,volume:vols.reduce((a,b)=>a+b,0)||0};
      }
    }catch(e){}
  }
  if(Object.keys(map).length<10) throw new Error('too few valid prices');
  return map;
}

async function fetchIndices(){
  const target='https://query2.finance.yahoo.com/v8/finance/spark?symbols=%5ENSEI%2C%5EBSESN&range=1d&interval=5m';
  const url=`https://corsproxy.io/?${encodeURIComponent(target)}`;
  const json=await tFetch(url,8000);
  for(const r of (json?.spark?.result||[])){
    const closes=(r?.response?.[0]?.indicators?.quote?.[0]?.close||[]).filter(v=>v!=null);
    const prev=r?.response?.[0]?.meta?.chartPreviousClose||0;
    const price=closes.length?closes[closes.length-1]:0;
    if(!price||!prev) continue;
    const pct=((price-prev)/prev)*100;
    const cls=pct>=0?'up':'dn';
    const str=`<span class="${cls}">${price.toLocaleString('en-IN',{maximumFractionDigits:0})} (${pct>=0?'+':''}${pct.toFixed(2)}%)</span>`;
    if(r.symbol==='^NSEI') document.getElementById('hN50').innerHTML=str;
    if(r.symbol==='^BSESN') document.getElementById('hSX').innerHTML=str;
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const f2=n=>n==null||isNaN(n)?'‚Äî':n.toFixed(2);
const sgn=n=>n>=0?'+':'';
const cc=n=>n>=0?'cu':'cd';
function fVol(n){if(!n)return'‚Äî';if(n>=1e7)return(n/1e7).toFixed(2)+'Cr';if(n>=1e5)return(n/1e5).toFixed(2)+'L';if(n>=1000)return(n/1000).toFixed(0)+'K';return n;}
function fMcap(n){if(!n)return'‚Äî';const c=n/1e7;if(c>=1e5)return'‚Çπ'+(c/1e5).toFixed(2)+'L Cr';if(c>=1000)return'‚Çπ'+(c/1000).toFixed(1)+'K Cr';return'‚Çπ'+c.toFixed(0)+' Cr';}
function fPx(n){if(!n)return'‚Äî';return'‚Çπ'+n.toLocaleString('en-IN',{minimumFractionDigits:2,maximumFractionDigits:2});}
function getCh(d){if(curTab==='5d')return d.change5d??d.change1d;if(curTab==='1mo')return d.change1mo??d.change1d;if(curTab==='ytd')return d.changeYtd??d.change1d;if(curTab==='1y')return d.change1y??d.change1d;return d.change1d;}
function tabLbl(){return{'1d':'Today','5d':'This Week','1mo':'This Month','ytd':'This Year (YTD)','1y':'12 Months'}[curTab]||'Today';}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function render(){
  const sorted=[...DATA].map(d=>({...d,_c:getCh(d)})).sort((a,b)=>b._c-a._c);
  const gainers=sorted.filter(d=>d._c>0);

  document.getElementById('sg').textContent=gainers.length;
  const avg=gainers.length?gainers.reduce((a,b)=>a+b._c,0)/gainers.length:0;
  document.getElementById('sa').textContent='+'+f2(avg)+'%';
  document.getElementById('sp').textContent=tabLbl();
  if(sorted[0]){
    document.getElementById('sb').textContent=sorted[0].name.split(' ').slice(0,2).join(' ');
    document.getElementById('sbv').textContent=sgn(sorted[0]._c)+f2(sorted[0]._c)+'%';
  }
  const sm={};
  for(const d of gainers){if(!sm[d.sector])sm[d.sector]={s:0,n:0};sm[d.sector].s+=d._c;sm[d.sector].n++;}
  let bs='',ba=0;
  for(const[k,v]of Object.entries(sm)){const a=v.s/v.n;if(a>ba){ba=a;bs=k;}}
  document.getElementById('ss').textContent=bs||'‚Äî';
  document.getElementById('ssv').textContent=bs?'+'+f2(ba)+'% avg':'‚Äî';
  document.getElementById('sv').textContent=fMcap(gainers.reduce((a,b)=>a+b.volume*b.price,0));

  // Top5
  document.getElementById('t5').innerHTML=sorted.slice(0,5).map((d,i)=>`
    <div class="top5-card${i===0?' r1':''}">
      <div class="rank-num">${i+1}</div>
      <div class="t5n">${d.name}</div><div class="t5s">${d.sector}</div>
      <div class="t5p ${cc(d._c)}">${sgn(d._c)}${f2(d._c)}%</div>
      <div class="t5pr">${fPx(d.price)} &nbsp;(${sgn(d.changeAbs)}${f2(d.changeAbs)})</div>
      <div class="t5v">Vol: ${fVol(d.volume)} ¬∑ MCap: ${fMcap(d.mcap)}</div>
    </div>`).join('');

  // Top15
  document.getElementById('t15').innerHTML=sorted.slice(0,15).map((d,i)=>`
    <div class="t15c">
      <div class="t15r">#${i+1}</div>
      <div class="t15i"><div class="t15n">${d.name}</div><div class="t15s">${d.ticker.replace('.NS','')} ¬∑ ${d.sector}</div></div>
      <div class="t15p ${cc(d._c)}">${sgn(d._c)}${f2(d._c)}%</div>
    </div>`).join('');

  renderTable(sorted);
  renderVol(gainers);
}

function renderTable(sorted){
  let rows=[...sorted].sort((a,b)=>{
    const k=sortK;
    let va=k==='change'?a._c:k==='rank'?sorted.indexOf(a):(a[k]||0);
    let vb=k==='change'?b._c:k==='rank'?sorted.indexOf(b):(b[k]||0);
    if(typeof va==='string')return sortD*va.localeCompare(vb);
    return sortD*(va-vb);
  });
  if(searchQ) rows=rows.filter(d=>d.name.toLowerCase().includes(searchQ)||d.ticker.toLowerCase().includes(searchQ)||d.sector.toLowerCase().includes(searchQ));
  document.getElementById('ti').textContent=`${rows.length} of ${sorted.length} stocks`;
  if(!rows.length){document.getElementById('tb').innerHTML='<tr class="empty-r"><td colspan="9">No results</td></tr>';return;}
  document.getElementById('tb').innerHTML=rows.map(d=>`<tr>
    <td class="cr">${sorted.indexOf(d)+1}</td>
    <td class="cn">${d.name}</td>
    <td class="ct">${d.ticker.replace('.NS','')}</td>
    <td><span class="spill">${d.sector}</span></td>
    <td class="cp">${fPx(d.price)}</td>
    <td class="${cc(d._c)}">${sgn(d._c)}${f2(d._c)}%</td>
    <td class="${cc(d.changeAbs)}">${sgn(d.changeAbs)}${f2(d.changeAbs)}</td>
    <td class="cv">${fVol(d.volume)}</td>
    <td>${fMcap(d.mcap)}</td>
  </tr>`).join('');
}

function renderVol(gainers){
  const s=[...gainers].sort((a,b)=>b.volume-a.volume);
  const mx=s[0]?.volume||1;
  document.getElementById('vb').innerHTML=s.slice(0,50).map((d,i)=>{
    const r=d.avgVolume?d.volume/d.avgVolume:1;
    const w=Math.min((d.volume/mx)*100,100);
    const sig=r>2?'üî• SURGE':r>1.5?'‚Üë High':'‚Äî';
    return`<tr>
      <td class="cr">${i+1}</td><td class="cn">${d.name}</td>
      <td class="cp">${fPx(d.price)}</td>
      <td class="cu">+${f2(d._c)}%</td>
      <td><div class="vwrap"><span class="cv">${fVol(d.volume)}</span><div class="vbg"><div class="vfill" style="width:${w}%"></div></div></div></td>
      <td class="${r>1.5?'up':'neu'}">${r.toFixed(1)}x</td>
      <td class="cv">${fMcap(d.volume*d.price)}</td>
      <td class="${r>2?'up':''}">${sig}</td>
    </tr>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONTROLS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setTab(tab,btn){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  btn.classList.add('active');
  curTab=tab;
  render();
}

function onSort(k){
  const ids={rank:'s0',name:'s1',ticker:'s2',sector:'s3',price:'s4',change:'s5',changeAbs:'s6',volume:'s7',mcap:'s8'};
  if(sortK===k) sortD*=-1; else{sortK=k;sortD=-1;}
  for(const id of Object.values(ids)){const el=document.getElementById(id);if(el)el.textContent='';}
  const el=document.getElementById(ids[k]);
  if(el) el.textContent=sortD===-1?'‚Üì':'‚Üë';
  render();
}

function onSearch(v){searchQ=v.toLowerCase();render();}

function showBanner(type,msg){
  const b=document.getElementById('banner');
  b.className='banner '+type;
  b.textContent=msg;
  b.style.display='block';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REFRESH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function tryLive(){
  document.getElementById('lLabel').textContent='Fetching‚Ä¶';
  try{
    const live=await fetchLive();
    DATA=DATA.map(d=>{
      const l=live[d.ticker];
      if(!l) return d;
      return{...d,price:l.price,change1d:l.changePct,changeAbs:l.changeAbs,volume:l.volume||d.volume};
    });
    const now=new Date().toLocaleTimeString('en-IN');
    document.getElementById('upd').textContent='Live ¬∑ '+now+' IST';
    document.getElementById('ft').textContent=now+' IST';
    document.getElementById('lLabel').textContent='LIVE NSE';
    showBanner('success','‚úÖ Live NSE data loaded! Prices are real-time from Yahoo Finance.');
    setTimeout(()=>{document.getElementById('banner').style.display='none';},5000);
    render();
    fetchIndices().catch(()=>{});
  }catch(e){
    console.warn('Live data failed:',e.message);
    document.getElementById('lLabel').textContent='DEMO';
    document.getElementById('upd').textContent='Demo ¬∑ '+new Date().toLocaleTimeString('en-IN');
    showBanner('info','‚ö° Showing demo data. Live NSE data unavailable right now ‚Äî data refreshes on each visit.');
  }
}

async function doRefresh(){
  const btn=document.getElementById('rBtn');
  btn.disabled=true;btn.textContent='‚Ü∫ Loading‚Ä¶';
  DATA=buildDemo();render();
  await tryLive();
  btn.disabled=false;btn.textContent='‚Ü∫ Refresh';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT ‚Äî instant, no loading screen
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
(function init(){
  DATA=buildDemo();
  document.getElementById('hN50').innerHTML='<span class="up">23,491 (+0.84%)</span>';
  document.getElementById('hSX').innerHTML='<span class="up">77,212 (+0.76%)</span>';
  const now=new Date().toLocaleTimeString('en-IN');
  document.getElementById('ft').textContent=now+' IST';
  document.getElementById('upd').textContent='Loading‚Ä¶';
  render();
  // Try live in background without blocking anything
  tryLive();
})();
</script>
</body>
</html>
